<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="robots" content="noindex,nofollow" />
  <title>NY„ÉÑ„Ç¢„ÉºÊó•Á®ãÔºà1/7„Äú1/15Ôºâ + NRFÂàÜÊãÖÔºà1/11„Éª1/12Ôºâ</title>
  <style>
    :root{
      --bg:#ffffff;
      --fg:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --shadow: 0 6px 18px rgba(0,0,0,.06);

      --tab:#f3f4f6;
      --tabOn:#111827;
      --tabOnFg:#ffffff;

      --chip:#f3f4f6;
      --chipOn:#111827;
      --chipOnFg:#ffffff;

      --commonBg:#f0fdf4;
      --commonBd:#bbf7d0;

      --nrfBg:#eff6ff;
      --nrfBd:#bfdbfe;

      --breakBg:#faf5ff;
      --breakBd:#e9d5ff;

      --groupBg:#fff7ed;
      --groupBd:#fed7aa;

      --mergeTagBg:#111827;
      --mergeTagFg:#ffffff;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
      line-height:1.45;
    }

    .topbar{
      position:sticky;
      top:0;
      z-index:50;
      background:rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
    }
    .topbar-inner{
      max-width:1180px;
      margin:0 auto;
      padding:12px 14px;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .title{
      font-weight:900;
      letter-spacing:.02em;
      white-space:nowrap;
      margin-right:6px;
    }
    .tabs{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .tab{
      border:1px solid var(--border);
      background:var(--tab);
      color:var(--fg);
      padding:8px 10px;
      border-radius:999px;
      cursor:pointer;
      font-weight:800;
      font-size:13px;
      white-space:nowrap;
      user-select:none;
    }
    .tab[aria-selected="true"]{
      background:var(--tabOn);
      color:var(--tabOnFg);
      border-color:var(--tabOn);
    }

    .chips{
      display:none;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .chip{
      border:1px solid var(--border);
      background:var(--chip);
      color:var(--fg);
      padding:7px 10px;
      border-radius:999px;
      cursor:pointer;
      font-weight:800;
      font-size:13px;
      white-space:nowrap;
      user-select:none;
    }
    .chip[aria-pressed="true"]{
      background:var(--chipOn);
      color:var(--chipOnFg);
      border-color:var(--chipOn);
    }

    .group{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .btn{
      border:1px solid var(--border);
      background:#fff;
      contains: content;
      padding:8px 10px;
      border-radius:10px;
      cursor:pointer;
      font-weight:800;
      font-size:13px;
      user-select:none;
    }
    .btn:hover{background:#fafafa}

    .search{
      display:flex;
      align-items:center;
      gap:8px;
      border:1px solid var(--border);
      background:#fff;
      padding:8px 10px;
      border-radius:12px;
    }
    .search input{
      border:none;
      outline:none;
      font-size:14px;
      width:min(320px, 62vw);
    }

    .toggles{
      display:none;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .toggle{
      display:flex;
      gap:6px;
      align-items:center;
      font-size:13px;
      color:var(--muted);
      user-select:none;
    }
    .toggle input{transform: translateY(1px);}

    .main{
      max-width:1180px;
      width:100%;
      margin:0 auto;
      padding:14px;
    }
    .hint{
      color:var(--muted);
      font-size:13px;
      margin:0 0 10px 0;
    }

    .board{
      border:1px solid var(--border);
      border-radius:16px;
      overflow:hidden;
      box-shadow:var(--shadow);
      background:#fff;
    }

    .colHeader{
      display:grid;
      grid-template-columns: 140px 1fr;
      border-bottom:1px solid var(--border);
      background:#fff;
    }
    .colHeader .left{
      padding:10px 12px;
      color:var(--muted);
      font-weight:900;
      font-size:13px;
      border-right:1px solid var(--border);
      white-space:nowrap;
    }
    .colHeader .right{
      overflow:auto;
      scrollbar-gutter: stable;
    }
    .colHeader .rightInner{
      display:grid;
      gap:10px;
      padding:10px 12px;
      min-width: 640px;
    }
    .hcell{
      border:1px solid var(--border);
      border-radius:12px;
      padding:8px 10px;
      font-weight:900;
      font-size:13px;
      background:#fafafa;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .hcell.on{
      background:#111827;
      color:#fff;
      border-color:#111827;
    }

    .rows{
      display:flex;
      flex-direction:column;
      background:#fff;
    }
    .row{
      display:grid;
      grid-template-columns: 140px 1fr;
      border-bottom:1px solid var(--border);
    }
    .row:last-child{border-bottom:none;}
    .timeBox{
      padding:12px 12px;
      border-right:1px solid var(--border);
      color:var(--muted);
      font-weight:900;
      font-size:13px;
      white-space:nowrap;
      background:#fff;
    }
    .cells{
      overflow:auto;
      scrollbar-gutter: stable;
    }
    .cellsInner{
      display:grid;
      gap:10px;
      padding:10px 12px 12px;
      min-width: 640px;
      align-items:stretch;
    }

    .card{
      border:1px solid var(--border);
      border-radius:12px;
      padding:9px 10px;
      background:#fff;
      min-height: 52px;
    }
    .card.common{
      background:var(--commonBg);
      border-color:var(--commonBd);
    }
    .card.nrf{
      background:var(--nrfBg);
      border-color:var(--nrfBd);
    }
    .card.break{
      background:var(--breakBg);
      border-color:var(--breakBd);
    }
    .card.group{
      background:var(--groupBg);
      border-color:var(--groupBd);
    }

    .mergeTag{
      display:inline-block;
      background:var(--mergeTagBg);
      color:var(--mergeTagFg);
      padding:3px 8px;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      margin:0 0 6px 0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:100%;
    }

    .itemTitle{
      font-weight:900;
      margin:0 0 4px 0;
      line-height:1.25;
    }
    .itemMeta{
      color:var(--muted);
      font-size:12px;
      margin:0;
      white-space:pre-wrap;
    }
    .small{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
      white-space:pre-wrap;
    }

    .single.rightInner,
    .single.cellsInner{
      grid-template-columns: 1fr !important;
      min-width: 0 !important;
    }

    .rightInner.nrfCols,
    .cellsInner.nrfCols{
      grid-template-columns: repeat(var(--cols, 6), minmax(220px, 1fr));
    }

    @media (max-width: 919px){
      .colHeader{grid-template-columns: 120px 1fr;}
      .row{grid-template-columns: 120px 1fr;}
      .timeBox{font-size:12px;}
      .colHeader .left{font-size:12px;}
      .hcell{font-size:12px;}
      .card{min-height: 50px;}
      .rightInner.nrfCols,
      .cellsInner.nrfCols{
        grid-template-columns: repeat(var(--cols, 6), minmax(200px, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="title">NY„ÉÑ„Ç¢„ÉºÊó•Á®ã</div>
      <div class="tabs" id="dayTabs"></div>
      <div class="chips" id="memberChips"></div>
      <div class="group">
        <button class="btn" id="btnAll">ÂÖ®Âì°</button>
        <button class="btn" id="btnClear">„ÇØ„É™„Ç¢</button>
      </div>
      <div class="search" title="Ê§úÁ¥¢Ôºà„Çø„Ç§„Éà„É´/Â†¥ÊâÄ/„Ç≠„Éº„ÉØ„Éº„ÉâÔºâ">
        üîé <input id="q" type="search" placeholder="Ê§úÁ¥¢Ôºà‰æãÔºöNRF / Pier 57 / Rokt / EXPOÔºâ" />
      </div>
      <div class="toggles" id="toggles">
        <label class="toggle"><input id="onlySelected" type="checkbox" checked /> ÈÅ∏Êäû„É°„É≥„Éê„Éº„Å†„ÅëË°®Á§∫ÔºàNRF„ÅÆ„ÅøÔºâ</label>
      </div>
    </div>
  </div>

  <div class="main">
    <p class="hint" id="hintText"></p>
    <div class="board" id="board"></div>
  </div>

<script>
  const MEMBERS = ["„Åì„Å∞„Åæ„Åø","Â§ßÁî∫","Ëó§Ê£Æ","ËäùÂ¥é","Êü≥Â∑ù","Áü¢ÈÉ®"];

  const DAYS = [
    {
      id:"d0107",
      label:"1/7(Ê∞¥)",
      date:"2026-01-07",
      mode:"common",
      slots:[
        { time:"17:10 ‚Üí 16:00", kind:"common", title:"AA 168/V  ÁæΩÁî∞ 17:10 ‚Üí JFK 16:00", location:"„Éï„É©„Ç§„Éà", note:"Á©∫Ê∏Ø‚Üí„Éõ„ÉÜ„É´ÁßªÂãïÔºè„Éõ„ÉÜ„É´„Åß„ÇÜ„Å£„Åè„Çä„Åó„Åæ„Åó„Çá„ÅÜ" },
      ]
    },
    {
      id:"d0108",
      label:"1/8(Êú®)",
      date:"2026-01-08",
      mode:"common",
      slots:[
        { time:"ÂçàÂâç", kind:"common", title:"Ëá™Áî±ÊôÇÈñì", location:"", note:"" },
        { time:"11:30„Äú", kind:"common", title:"Â∫óËàóË¶ñÂØüÔºàÈ£ü‰∫ãÔºã„É™„ÉÜ„Éº„É´Ë¶ñÂØüÔºâ", location:"ÁßªÂãï„Åó„Å™„Åå„Çâ", note:
          "‚óè Joe‚Äôs ShanghaiÔºà46 BoweryÔºâÂ∞èÁ±†ÂåÖ\n" +
          "‚óè Wegmans Astor PlaceÔºà770 BroadwayÔºâ\n" +
          "‚óè Whole Foods MarketÔºà4 Union Sq EÔºâ\n" +
          "‚óè Trader Joe‚ÄôsÔºà142 E 14th StÔºâ\n" +
          "‚óè Whole Foods Market Daily ShopÔºà301 W 50th StÔºâ\n" +
          "‚óè „É≠„ÉÉ„ÇØ„Éï„Çß„É©„Éº„Çª„É≥„Çø„ÉºÔºà„Çπ„Ç±„Éº„Éà„É™„É≥„ÇØÔºâ\n" +
          "‚óè „Ç´„Éº„Éç„ÇÆ„Éº„Éõ„Éº„É´\n" +
          "‚óè Amazon GoÔºà150 E 53rd StÔºâ"
        },
        { time:"Â§ú", kind:"group", title:"Ôºà‰∏ÄÈÉ®ÔºâÂ∞èÊûóÔºöPwC/ÂçöÂ†±Â†Ç‰ºöÂêà", location:"", note:"" },
      ]
    },
    {
      id:"d0109",
      label:"1/9(Èáë)",
      date:"2026-01-09",
      mode:"common",
      slots:[
        { time:"ÁµÇÊó•", kind:"common", title:"„Åø„Çì„Å™„ÅÆËá™Áî±ÊôÇÈñì", location:"", note:"" },
      ]
    },
    {
      id:"d0110",
      label:"1/10(Âúü)",
      date:"2026-01-10",
      mode:"common",
      slots:[
        { time:"8:00-17:00", kind:"group", title:"Retail Media„ÅÆ„Åø„ÅÆ1Êó•„Çª„ÉÉ„Ç∑„Éß„É≥", location:"Pier 60, 60 Chelsea Piers", note:"ÂØæË±°ÔºöÂ∞èÊûó„ÉªËäùÂ¥é„ÉªÊü≥Â∑ù„ÉªÁü¢ÈÉ®" },
        { time:"9:00-17:00„Åî„Çç", kind:"group", title:"ÔºúÂçöÂ†±Â†Ç„É™„ÉÜ„Éº„É´„ÉÑ„Ç¢„ÉºÔºû ÁèæÂú∞Â∫óËàóË¶ñÂØü", location:"", note:"ÂØæË±°ÔºöÂ§ßÁî∫„ÉªËó§Ê£Æ" },
        { time:"Â§ú", kind:"group", title:"Ôºà‰∏ÄÈÉ®ÔºâÂ∞èÊûóÔºö„Çµ„É≥„Éà„É™„Éº‰∏ªÂÇ¨ ‰ºöÂêàÂèÇÂä†", location:"", note:"" },
      ]
    },

    {
      id:"d0111",
      label:"1/11(Êó•) NRF Day1",
      date:"2026-01-11",
      mode:"nrf",
      slots:[
        { time:"8:00", assigns: Object.fromEntries(MEMBERS.map(m => [m, {kind:"nrf", title:"Âà∞ÁùÄ„ÄúÂÖ•Â†¥„Äú8:30„Åæ„Åß„Éâ„Éº„Éä„ÉÑÈ£ü„Åπ„Çã", location:"", note:""} ])) },
        { time:"8:30-9:15", assigns: Object.fromEntries(MEMBERS.map(m => [m, {kind:"nrf", title:"NRF Chairman‚Äôs opening remarks: Welcome to The Next Now!", location:"Javits North, Level 5, Vusion Theatre", note:""} ])) },
        { time:"9:15-9:45", assigns: Object.fromEntries(MEMBERS.map(m => [m, {kind:"nrf", title:"Opening Keynote ‚Äì Rewriting the commerce playbook: Michael RubinÔºàFanaticsÔºâ", location:"Javits North, Level 5, Vusion Theatre", note:""} ])) },
        { time:"9:45-10:15", assigns: Object.fromEntries(MEMBERS.map(m => [m, {kind:"nrf", title:"The AI Platform Shift and the Opportunity Ahead for Retail", location:"Javits North, Level 5, Vusion Theatre", note:""} ])) },

        {
          time:"10:30-11:00",
          assigns: {
            "„Åì„Å∞„Åæ„Åø": {kind:"nrf", title:"The Intelligent Store: How dm and Vusion Are Shaping the Future of Retail", location:"River Pavilion, Snowflake Stage", note:""},
            "Â§ßÁî∫":     {kind:"nrf", title:"The Intelligent Store: How dm and Vusion Are Shaping the Future of Retail", location:"River Pavilion, Snowflake Stage", note:""},
            "Ëó§Ê£Æ":     {kind:"nrf", title:"The Intelligent Store: How dm and Vusion Are Shaping the Future of Retail", location:"River Pavilion, Snowflake Stage", note:""},
            "ËäùÂ¥é":     {kind:"break", title:"‰ºëÊÜ©/ÁßªÂãï", location:"", note:""},
            "Êü≥Â∑ù":     {kind:"break", title:"‰ºëÊÜ©/ÁßªÂãï", location:"", note:""},
            "Áü¢ÈÉ®":     {kind:"break", title:"‰ºëÊÜ©/ÁßªÂãï", location:"", note:""}
          }
        }
      ]
    },

    {
      id:"d0112",
      label:"1/12(Êúà) NRF Day2",
      date:"2026-01-12",
      mode:"nrf",
      slots:[
        { time:"8:00", assigns: Object.fromEntries(MEMBERS.map(m => [m, {kind:"nrf", title:"Âà∞ÁùÄ„ÄúÂÖ•Â†¥„Äú8:30„Åæ„Åß„Éâ„Éº„Éä„ÉÑÈ£ü„Åπ„Çã", location:"", note:""} ])) },
        { time:"8:30-9:15", assigns: Object.fromEntries(MEMBERS.map(m => [m, {kind:"nrf", title:"From gin to global fandom: Ryan Reynolds and the new rules of brand building", location:"Javits North, Level 5, Vusion Theatre", note:""} ])) }
      ]
    },

    {
      id:"d0113",
      label:"1/13(ÁÅ´)",
      date:"2026-01-13",
      mode:"common",
      slots:[
        { time:"10:30", kind:"common", title:"Ôºà„Ç§„Éô„É≥„ÉàÔºâÈñãÂ†¥", location:"Google Office Pier 57", note:"" },
        { time:"11:00-13:00", kind:"common", title:"Ôºà„Ç§„Éô„É≥„ÉàÔºâ„Çª„ÉÉ„Ç∑„Éß„É≥Ôºã„É©„É≥„ÉÅÂÖº„Éç„ÉÉ„Éà„ÉØ„Éº„Ç≠„É≥„Ç∞", location:"Google Office Pier 57", note:"11:00-12:00 „Çª„ÉÉ„Ç∑„Éß„É≥Ôºè12:00-13:00 „É©„É≥„ÉÅÔºÜ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ" }
      ]
    },

    {
      id:"d0114",
      label:"1/14(Ê∞¥)",
      date:"2026-01-14",
      mode:"common",
      slots:[
        { time:"10:00 ‚Üí ÁøåÊó•14:35", kind:"common", title:"AA 167  JFK 10:00 ‚Üí ÁæΩÁî∞ 14:35ÔºàÁøåÊó•Ôºâ", location:"„Éï„É©„Ç§„Éà", note:"Â∏∞ÂõΩ" }
      ]
    },
    {
      id:"d0115",
      label:"1/15(Êú®)",
      date:"2026-01-15",
      mode:"common",
      slots:[
        { time:"14:35", kind:"common", title:"ÁæΩÁî∞Âà∞ÁùÄÔºàËß£Êï£Ôºâ", location:"", note:"" }
      ]
    }
  ];

  const state = {
    dayId: DAYS[0].id,
    selectedMembers: new Set(MEMBERS), // „Éá„Éï„Ç©„É´„ÉàÔºöÂÖ®Âì°ÈÅ∏Êäû
    query: "",
    onlySelected: true                  // „Éá„Éï„Ç©„É´„ÉàÔºöÈÅ∏Êäû„É°„É≥„Éê„Éº„Å†„ÅëË°®Á§∫ON
  };

  function norm(s){
    return (s || "").toString().toLowerCase().replace(/\s+/g," ").trim();
  }
  function matchQuery(text, q){
    if (!q) return true;
    return norm(text).includes(norm(q));
  }
  function getDay(){
    return DAYS.find(d => d.id === state.dayId) || DAYS[0];
  }
  function escapeHtml(str){
    return (str ?? "").toString()
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#39;");
  }
  function kindClass(kind){
    if (kind === "nrf") return "nrf";
    if (kind === "break") return "break";
    if (kind === "group") return "group";
    return "common";
  }

  function cardHTML(item, mergedNamesText, span){
    const k = kindClass(item.kind);
    const title = item.title || "";
    const loc = item.location || "";
    const note = item.note || "";
    const tag = mergedNamesText ? `<div class="mergeTag">${escapeHtml(mergedNamesText)}</div>` : ``;
    const style = span ? `style="grid-column: span ${span};"` : "";
    return `
      <div class="card ${k}" ${style}>
        ${tag}
        <p class="itemTitle">${escapeHtml(title)}</p>
        ${loc ? `<p class="itemMeta">${escapeHtml(loc)}</p>` : ``}
        ${note ? `<div class="small">${escapeHtml(note)}</div>` : ``}
      </div>
    `;
  }

  function slotTextCommon(slot){
    return `${slot.time} ${slot.title||""} ${slot.location||""} ${slot.note||""}`;
  }
  function slotTextNrf(slot){
    let t = slot.time + " ";
    for (const m of MEMBERS){
      const a = slot.assigns[m];
      if (a) t += `${a.kind||""} ${a.title||""} ${a.location||""} ${a.note||""} `;
    }
    return t;
  }

  function renderTabs(){
    const el = document.getElementById("dayTabs");
    el.innerHTML = "";
    for (const d of DAYS){
      const b = document.createElement("button");
      b.className = "tab";
      b.textContent = d.label;
      b.setAttribute("aria-selected", d.id === state.dayId ? "true" : "false");
      b.onclick = () => {
        state.dayId = d.id;
        renderAll();
        window.scrollTo({top:0, behavior:"instant"});
      };
      el.appendChild(b);
    }
  }

  function renderMemberChipsIfNeeded(day){
    const chips = document.getElementById("memberChips");
    const toggles = document.getElementById("toggles");

    if (day.mode === "nrf"){
      chips.style.display = "flex";
      toggles.style.display = "flex";
      chips.innerHTML = "";

      for (const m of MEMBERS){
        const b = document.createElement("button");
        b.className = "chip";
        b.textContent = m;
        b.setAttribute("aria-pressed", state.selectedMembers.has(m) ? "true" : "false");
        b.onclick = () => {
          if (state.selectedMembers.has(m)) state.selectedMembers.delete(m);
          else state.selectedMembers.add(m);
          renderAll();
        };
        chips.appendChild(b);
      }
    } else {
      chips.style.display = "none";
      toggles.style.display = "none";
    }
  }

  function renderHint(day){
    const el = document.getElementById("hintText");
    if (day.mode === "nrf"){
      el.textContent = "NRFÂàÜÊãÖÔºöÂêå„ÅòÂÜÖÂÆπ„Å´Ë§áÊï∞‰∫∫„ÅåÂèÇÂä†„Åô„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Ç´„Éº„Éâ„ÇíÊ®™„Å´ÁµêÂêà„Åó„Å¶Ë°®Á§∫„Åó„Åæ„Åô„ÄÇ";
    } else {
      el.textContent = "ÂÖ®‰ΩìÊó•Á®ãÔºöÂÖ®Âì°ÂÖ±ÈÄö„ÅÆ„Çø„Ç§„É†„É©„Ç§„É≥Ë°®Á§∫„ÄÇ";
    }
  }

  function visibleMembersForNrf(){
    if (!state.onlySelected) return MEMBERS.slice();
    if (state.selectedMembers.size === 0) return MEMBERS.slice();
    return MEMBERS.filter(m => state.selectedMembers.has(m));
  }

  function makeKeyFromItem(item){
    const kind = item?.kind ?? "";
    const title = item?.title ?? "";
    const location = item?.location ?? "";
    const note = item?.note ?? "";
    return `${kind}|||${title}|||${location}|||${note}`;
  }

  // memVis„ÅÆÈ†ÜÁï™„Åß„ÄÅÂêå„Åò„Ç≠„Éº„ÇíÈÄ£Á∂öÁµêÂêàÔºàÂèØË™≠ÊÄßÂÑ™ÂÖàÔºâ
  function buildMergedCells(memVis, assigns){
    const result = [];
    let i = 0;

    while (i < memVis.length){
      const m = memVis[i];
      const item = assigns[m];
      const key = makeKeyFromItem(item);

      let span = 1;
      let names = [m];

      let j = i + 1;
      while (j < memVis.length){
        const mj = memVis[j];
        const itemj = assigns[mj];
        const keyj = makeKeyFromItem(itemj);
        if (keyj !== key) break;
        span++;
        names.push(mj);
        j++;
      }

      result.push({ item, span, names });
      i = j;
    }

    return result;
  }

  function renderBoard(){
    const board = document.getElementById("board");
    const day = getDay();
    const q = state.query;

    if (day.mode === "common"){
      const slots = day.slots.filter(s => matchQuery(slotTextCommon(s), q));
      board.innerHTML = `
        <div class="colHeader">
          <div class="left">ÊôÇÈñì</div>
          <div class="right">
            <div class="rightInner single">
              <div class="hcell on">ÂÖ®Âì°</div>
            </div>
          </div>
        </div>
        <div class="rows">
          ${slots.map(s => `
            <div class="row">
              <div class="timeBox">${escapeHtml(s.time||"")}</div>
              <div class="cells">
                <div class="cellsInner single">
                  ${cardHTML(s, "", 0)}
                </div>
              </div>
            </div>
          `).join("")}
        </div>
      `;
      return;
    }

    const memVis = visibleMembersForNrf();
    const slots = day.slots.filter(s => matchQuery(slotTextNrf(s), q));
    const cols = memVis.length || 1;

    const headerCells = memVis.map(m => {
      const on = state.selectedMembers.has(m);
      return `<div class="hcell ${on ? "on" : ""}">${escapeHtml(m)}</div>`;
    }).join("");

    const bodyRows = slots.map(slot => {
      const merged = buildMergedCells(memVis, slot.assigns);
      const cards = merged.map(g => {
        const namesText = g.names.length >= 2 ? `ÂèÇÂä†Ôºö${g.names.join(" / ")}` : "";
        return cardHTML(g.item, namesText, g.span);
      }).join("");

      return `
        <div class="row">
          <div class="timeBox">${escapeHtml(slot.time||"")}</div>
          <div class="cells">
            <div class="cellsInner nrfCols" style="--cols:${cols}">
              ${cards}
            </div>
          </div>
        </div>
      `;
    }).join("");

    board.innerHTML = `
      <div class="colHeader">
        <div class="left">ÊôÇÈñì</div>
        <div class="right">
          <div class="rightInner nrfCols" style="--cols:${cols}">
            ${headerCells}
          </div>
        </div>
      </div>
      <div class="rows">
        ${bodyRows}
      </div>
    `;

    syncHorizontalScroll();
  }

  function syncHorizontalScroll(){
    const headerRight = document.querySelector(".colHeader .right");
    if (!headerRight) return;
    const rows = Array.from(document.querySelectorAll(".row .cells"));

    let lock = false;
    const syncFrom = (src) => {
      if (lock) return;
      lock = true;
      const x = src.scrollLeft;
      if (src !== headerRight) headerRight.scrollLeft = x;
      for (const r of rows){
        if (r !== src) r.scrollLeft = x;
      }
      lock = false;
    };

    headerRight.addEventListener("scroll", () => syncFrom(headerRight), {passive:true});
    for (const r of rows){
      r.addEventListener("scroll", () => syncFrom(r), {passive:true});
    }
  }

  function renderAll(){
    const day = getDay();
    renderTabs();
    renderMemberChipsIfNeeded(day);
    renderHint(day);

    const onlySelected = document.getElementById("onlySelected");
    onlySelected.checked = state.onlySelected;

    renderBoard();
  }

  document.getElementById("q").addEventListener("input", (e) => {
    state.query = e.target.value || "";
    renderAll();
  });

  document.getElementById("onlySelected").addEventListener("change", (e) => {
    state.onlySelected = !!e.target.checked;
    renderAll();
  });

  document.getElementById("btnAll").addEventListener("click", () => {
    state.selectedMembers = new Set(MEMBERS);
    renderAll();
  });

  document.getElementById("btnClear").addEventListener("click", () => {
    state.selectedMembers.clear();
    state.query = "";
    document.getElementById("q").value = "";
    state.onlySelected = true;
    renderAll();
  });

  renderAll();
</script>
</body>
</html>
